package com.skilldistillery.smoochyzoo.data;

import java.util.ArrayList;
import java.util.List;

import org.springframework.stereotype.Service;

import com.skilldistillery.jpasmoochyzoo.entities.Species;

import jakarta.persistence.EntityManager;
import jakarta.persistence.EntityManagerFactory;
import jakarta.persistence.Persistence;
import jakarta.persistence.PersistenceContext;
import jakarta.persistence.Query;
import jakarta.transaction.Transactional;

@Service
@Transactional
public class SpeciesDAOImpl implements SpeciesDAO
{
	@PersistenceContext
	private EntityManager em;
	

	@Override
	public Species findSpeciesById(int id)
	{
		Species species = null;
		
		species = em.find(Species.class, id);
		
		return species;
		
	}
	
	@Override
	public List<Species> findAllCategories()
	{
		List<Species> speciesList = new ArrayList<>();
		String jpql = "Select species from Species species";
		
		speciesList = em.createQuery(jpql, Species.class).getResultList();
		
		return speciesList;
	}
	
	
	@Override
	public Species addSpecies(Species species)
	{
		
		em.persist(species);


		// return the Species object
		System.out.println(species.toString());
		
		return species;
		
	} // end add species
	
	@Override
	public Species updateSpecies(Species species)
	{
		Species updatedSpecies = null;
		
		if (species == null)
		{
			return null;
		}
		
		updatedSpecies = em.find(Species.class, species.getId());
		
		if ((!species.getName().isEmpty()) && (!species.getName().isBlank()) && (!species.getName().equals(null)))
		{
				updatedSpecies.setName(species.getName());
		}
		
		if ((!species.getDescription().isEmpty()) && (!species.getDescription().isBlank()) && (!species.getDescription().equals(null)))
		{
				updatedSpecies.setName(species.getDescription());
		}
		
		
		em.persist(updatedSpecies);

		
		// return the updated Species object
		System.out.println("\nUpdated Species = " + updatedSpecies.toString());
		
		return updatedSpecies;
		
	} // end update species
	
	
	@Override
	public int deleteSpecies(Species species)
	{
	
		Species managedSpecies = null;
		int rowsDeleted = 0;
		
		if (species != null)
		{
			int id = species.getId();
			
			Query query = em.createQuery("Delete species from Species species where id = :id");
			query.setParameter("id", id);
			
			rowsDeleted = query.executeUpdate();
		}
		
		return rowsDeleted;
		
	} // end delete species
}
